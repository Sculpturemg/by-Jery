<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>L'Art de la Sculpture Malgache</title>
<style>
:root{--accent:#8B5E3C;--bg:#fbf8f5;--muted:#666;--card:#fff}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#222}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:var(--accent);color:#fff}
.brand{font-weight:800}
.nav{display:flex;gap:8px;flex-wrap:wrap}
.nav button{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;padding:8px 12px;border-radius:999px;cursor:pointer}
.container{max-width:1100px;margin:18px auto;padding:0 16px}
.section{margin-top:18px;padding:14px;background:var(--card);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.section h2{color:var(--accent);margin:0 0 10px}
.hero{display:flex;gap:20px;align-items:center}
.hero .left{flex:1}
.thumb{width:320px;border-radius:10px;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover;cursor:pointer}
.services-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px}
.service-card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
.gallery .item{position:relative;border-radius:8px;overflow:hidden;background:#eee;padding-bottom:6px}
.gallery img{width:100%;height:140px;object-fit:cover;display:block;cursor:pointer;transition:transform .18s}
.gallery img:hover{transform:scale(1.04)}
.caption{padding:8px;font-size:13px}
.title{font-weight:700;color:#222}
.desc{color:var(--muted);font-size:13px;margin-top:4px}
.price{color:var(--accent);font-weight:800;margin-top:6px}
.footer{padding:20px;text-align:center;color:var(--muted)}
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px}
.lightbox .box{background:#fff;padding:12px;border-radius:10px;max-width:900px;width:100%;display:flex;gap:12px;align-items:flex-start}
.lightbox img{max-width:60%;height:auto;border-radius:8px}
.lightbox .info{max-width:40%}
.input,textarea,input[type=file],select{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd;margin-bottom:8px}
.btn{background:var(--accent);color:#fff;border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid var(--accent)}
.admin-panel{margin-top:10px;background:#fff8f0;padding:12px;border-radius:10px;display:none}
.login-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:10000}
.login-card{background:#fff;padding:18px;border-radius:12px;width:94%;max-width:420px}
.row{display:flex;gap:8px}
.row .col{flex:1}
.note{color:var(--muted);font-size:13px}
@media(max-width:820px){.hero{flex-direction:column}.thumb{width:100%}.lightbox .box{flex-direction:column}.lightbox img{max-width:100%}.lightbox .info{max-width:100%}}
</style>
</head>
<body>

<header class="header">
  <div class="brand">L'Art de la Sculpture Malgache</div>
  <nav class="nav">
    <button onclick="show('accueil')">Accueil</button>
    <button onclick="show('apropos')">À propos</button>
    <button onclick="show('prehistoire')">Pré-histoire</button>
    <button onclick="show('services')">Services</button>
    <button onclick="show('galerie')">Galerie</button>
    <button onclick="show('commande')">Commander</button>
    <button onclick="show('contact')">Contact</button>
    <button onclick="openLogin()">Admin</button>
  </nav>
</header>

<main class="container">
  <!-- Accueil -->
  <section id="accueil" class="section">
    <div class="hero">
      <div class="left">
        <h2 id="heroTitle">Histoire & héritage de la sculpture malgache</h2>
        <p id="heroText"></p>
        <div class="note" id="adminNotice" style="display:none">Admin connecté — outils d'édition visibles</div>
      </div>
      <div class="thumb">
        <img id="heroImg" src="" alt="Accueil" onclick="openLightboxFromHero()">
      </div>
    </div>
    <div id="adminAccueil" class="admin-panel">
      <h3>Modifier Accueil</h3>
      <textarea id="editHeroText" rows="4" class="input"></textarea>
      <input type="file" id="editHeroImage" accept="image/*" class="input">
      <div class="row">
        <button class="btn" onclick="saveHero()">Enregistrer</button>
        <button class="btn ghost" onclick="resetHero()">Réinitialiser</button>
      </div>
    </div>
  </section>

  <!-- À propos -->
  <section id="apropos" class="section" style="display:none">
    <h2>À propos</h2>
    <p id="aboutText"></p>
    <div id="adminApropos" class="admin-panel">
      <h3>Modifier À propos</h3>
      <textarea id="editAbout" rows="4" class="input"></textarea>
      <button class="btn" onclick="saveAbout()">Enregistrer</button>
    </div>
  </section>

  <!-- Pré-histoire -->
  <section id="prehistoire" class="section" style="display:none">
    <h2>Pré-histoire et Origines</h2>
    <p id="prehistoireText"></p>
    <div id="adminPrehistoire" class="admin-panel">
      <h3>Modifier Pré-histoire</h3>
      <textarea id="editPrehistoire" rows="4" class="input"></textarea>
      <button class="btn" onclick="savePrehistoire()">Enregistrer</button>
    </div>
  </section>

  <!-- Services -->
  <section id="services" class="section" style="display:none">
    <h2>Services</h2>
    <div id="servicesGrid" class="services-grid"></div>
    <div id="adminServices" class="admin-panel">
      <h3>Modifier Services</h3>
      <textarea id="editServices" rows="4" class="input" placeholder="Une ligne = un service"></textarea>
      <button class="btn" onclick="saveServices()">Enregistrer</button>
    </div>
  </section>

  <!-- Galerie -->
  <section id="galerie" class="section" style="display:none">
    <h2>Galerie</h2>
    <div id="galleryGrid" class="gallery"></div>
    <div id="adminGallery" class="admin-panel">
      <h3>Gérer la galerie (titre / description / prix)</h3>
      <input type="file" id="galleryFile" accept="image/*" class="input">
      <input id="galleryTitle" class="input" placeholder="Titre">
      <input id="galleryPrice" class="input" placeholder="Prix">
      <textarea id="galleryDesc" rows="2" class="input" placeholder="Brève description"></textarea>
      <div class="row">
        <button class="btn" onclick="addGalleryItem()">Ajouter</button>
        <button class="btn ghost" onclick="clearGallery()">Vider la galerie</button>
      </div>
    </div>
  </section>

  <!-- Commande -->
  <section id="commande" class="section" style="display:none">
    <h2>Commander une œuvre</h2>
    <form id="orderForm">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input type="text" id="orderName" placeholder="Votre nom" required>
        <input type="email" id="orderEmail" placeholder="Votre e-mail" required>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input type="text" id="orderTel" placeholder="Téléphone">
        <select id="orderType">
          <option value="bois">Bois</option>
          <option value="pierre">Pierre</option>
          <option value="mixte">Mixte</option>
        </select>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
        <select id="orderOeuvre"></select>
        <input type="number" id="orderQty" min="1" value="1">
      </div>
      <textarea id="orderMsg" placeholder="Message / détails" style="margin-top:8px"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" type="submit">Envoyer la commande</button>
        <button class="btn ghost" type="button" onclick="resetOrderForm()">Annuler</button>
      </div>
    </form>
    <div id="adminOrders" class="admin-panel">
      <h3>Commandes reçues</h3>
      <div id="ordersList"></div>
      <div style="margin-top:8px">
        <button class="btn ghost" onclick="clearOrders()">Vider les commandes</button>
      </div>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="section" style="display:none">
    <h2>Contact</h2>
    <p>Email : <span id="contactEmail"></span></p>
    <p>Téléphone : <span id="contactTel"></span></p>
    <p>Facebook : <span id="contactFB"></span></p>
    <p>WhatsApp : <span id="contactWA"></span></p>
    <div id="adminContact" class="admin-panel">
      <h3>Modifier Contact</h3>
      <input id="editContactEmail" class="input" placeholder="Email">
      <input id="editContactTel" class="input" placeholder="Téléphone">
      <input id="editContactFB" class="input" placeholder="Facebook">
      <input id="editContactWA" class="input" placeholder="WhatsApp">
      <button class="btn" onclick="saveContact()">Enregistrer</button>
    </div>
  </section>

  <!-- Admin Settings -->
  <section id="adminSettings" class="section" style="display:none">
    <h2>Administration</h2>
    <div class="admin-panel">
      <h3>Modifier identifiants Admin</h3>
      <div class="row">
        <div class="col"><input id="newAdminEmail" class="input" placeholder="Nouvel email"></div>
        <div class="col"><input id="newAdminPass" class="input" placeholder="Nouveau mot de passe"></div>
      </div>
      <div class="row">
        <button class="btn" onclick="changeAdminCreds()">Enregistrer identifiants</button>
        <button class="btn ghost" onclick="logoutAdmin()">Se déconnecter</button>
      </div>
    </div>
    <div class="admin-panel">
      <h3>Sauvegarder / Restaurer</h3>
      <div class="row">
        <button class="btn" onclick="exportJSON()">Exporter JSON</button>
        <input type="file" id="importFile" class="input">
        <button class="btn ghost" onclick="importJSON()">Importer JSON</button>
      </div>
    </div>
  </section>
</main>

<footer class="footer">© <span id="year"></span> L'Art de la Sculpture Malgache — Madagascar</footer>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" onclick="if(event.target.id==='lightbox') closeLightbox()">
  <div class="box">
    <img id="lightboxImg" src="">
    <div class="info">
      <div class="title" id="lightboxTitle"></div>
      <div class="desc" id="lightboxDesc"></div>
      <div class="price" id="lightboxPrice"></div>
      <div style="margin-top:10px"><button class="btn" onclick="closeLightbox()">Fermer</button></div>
    </div>
  </div>
</div>

<!-- LOGIN MODAL -->
<div id="loginModal" class="login-modal" onclick="if(event.target.id==='loginModal') closeLogin()">
  <div class="login-card">
    <h3>Connexion Admin</h3>
    <input id="loginEmail" class="input" placeholder="Email">
    <input id="loginPass" class="input" placeholder="Mot de passe" type="password">
    <div class="row">
      <button class="btn" onclick="login()">Se connecter</button>
      <button class="btn ghost" onclick="closeLogin()">Annuler</button>
    </div>
    <p id="loginError" style="color:#b00020"></p>
    <p class="note">Identifiants par défaut : <strong>admin@site.com</strong> / <strong>1234</strong></p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
// ===== STATE =====
const KEY='sculpture_gallery_final_v3';
function defaultState(){ return {
  creds:{email:'admin@site.com',pass:'1234'},
  hero:{text:'Le sculpteur malgache puise son inspiration...', image:'https://i.imgur.com/yz5w2JY.jpg'},
  about:'Artisan sculpteur malgache — bois, pierre et matériaux naturels.',
  prehistoire:'Les premières sculptures malgaches remontent à des siècles ; elles représentaient ancêtres et esprits.',
  services:['Commandes personnalisées','Restauration d’œuvres','Expositions','Ateliers & Formations'],
  contact:{email:'contact@artmalagasy.mg',tel:'+261 34 00 000 00',fb:'facebook.com/natureartisanale',wa:'+261 34 00 000 00'},
  gallery:[
    {image:'https://i.imgur.com/yz5w2JY.jpg',title:'Sculpture Bois 1',desc:'Bois sculpté',price:'120 000 MGA'},
    {image:'https://i.imgur.com/E1fA1H7.jpg',title:'Sculpture Pierre 1',desc:'Pierre gravée',price:'200 000 MGA'}
  ],
  orders:[]
};}
let state;
function loadState(){ try{ state=JSON.parse(localStorage.getItem(KEY))||defaultState(); }catch(e){ state=defaultState(); } saveState();}
function saveState(){ localStorage.setItem(KEY,JSON.stringify(state)); }

// ===== RENDER =====
let isAdmin=false;
function renderAll(){
  document.getElementById('year').textContent=new Date().getFullYear();
  document.getElementById('heroText').textContent=state.hero.text;
  document.getElementById('heroImg').src=state.hero.image;
  document.getElementById('aboutText').textContent=state.about;
  document.getElementById('prehistoireText').textContent=state.prehistoire;
  document.getElementById('contactEmail').textContent=state.contact.email;
  document.getElementById('contactTel').textContent=state.contact.tel;
  document.getElementById('contactFB').textContent=state.contact.fb;
  document.getElementById('contactWA').textContent=state.contact.wa;
  renderServices();
  renderGallery();
  renderOrders();
  populateOeuvres();
}
function renderServices(){ const grid=document.getElementById('servicesGrid');grid.innerHTML='';state.services.forEach(s=>{const d=document.createElement('div');d.className='service-card';d.textContent=s;grid.appendChild(d);});}
function renderGallery(){ const g=document.getElementById('galleryGrid');g.innerHTML=''; state.gallery.forEach((i,idx)=>{const div=document.createElement('div');div.className='item'; const img=document.createElement('img');img.src=i.image;img.onclick=()=>openLightboxFromGallery(idx); const cap=document.createElement('div');cap.className='caption'; const t=document.createElement('div');t.className='title';t.textContent=i.title; const d=document.createElement('div');d.className='desc';d.textContent=i.desc; const p=document.create
// ----- Gallery admin -----
t.contentEditable=isAdmin; t.onblur=()=>{i.title=t.textContent; saveState();}
d.contentEditable=isAdmin; d.onblur=()=>{i.desc=d.textContent; saveState();}
p.contentEditable=isAdmin; p.onblur=()=>{i.price=p.textContent; saveState();}
cap.appendChild(t); cap.appendChild(d); cap.appendChild(p);
if(isAdmin){ 
    const del=document.createElement('button'); 
    del.className='btn ghost'; 
    del.textContent='Supprimer'; 
    del.style.marginTop='4px'; 
    del.onclick=()=>{state.gallery.splice(idx,1); saveState(); renderGallery(); populateOeuvres();}; 
    cap.appendChild(del);
}
div.appendChild(img); div.appendChild(cap); g.appendChild(div);
});
if(isAdmin){
    new Sortable(g,{animation:150,onEnd:function(evt){
        const item=state.gallery.splice(evt.oldIndex,1)[0];
        state.gallery.splice(evt.newIndex,0,item); saveState();
    }});
}

// ----- Lightbox -----
function openLightboxFromGallery(idx){
    const i=state.gallery[idx];
    document.getElementById('lightboxImg').src=i.image;
    document.getElementById('lightboxTitle').textContent=i.title;
    document.getElementById('lightboxDesc').textContent=i.desc;
    document.getElementById('lightboxPrice').textContent=i.price;
    document.getElementById('lightbox').style.display='flex';
}
function openLightboxFromHero(){
    document.getElementById('lightboxImg').src=state.hero.image;
    document.getElementById('lightboxTitle').textContent='';
    document.getElementById('lightboxDesc').textContent=state.hero.text;
    document.getElementById('lightboxPrice').textContent='';
    document.getElementById('lightbox').style.display='flex';
}
function closeLightbox(){document.getElementById('lightbox').style.display='none';}

// ----- Navigation -----
function show(id){
    ['accueil','apropos','prehistoire','services','galerie','commande','contact','adminSettings'].forEach(s=>{
        document.getElementById(s).style.display=(s===id?'block':'none');
    });
}

// ----- Admin -----
function openLogin(){document.getElementById('loginModal').style.display='flex';}
function closeLogin(){document.getElementById('loginModal').style.display='none';}
function login(){
    const e=document.getElementById('loginEmail').value;
    const p=document.getElementById('loginPass').value;
    if(e===state.creds.email && p===state.creds.pass){
        isAdmin=true;
        document.getElementById('loginModal').style.display='none';
        showAdminPanels();
        renderAll();
    } else {
        document.getElementById('loginError').textContent='Identifiants incorrects';
    }
}
function logoutAdmin(){isAdmin=false; hideAdminPanels(); renderAll(); alert('Déconnecté');}
function showAdminPanels(){['adminAccueil','adminApropos','adminPrehistoire','adminServices','adminGallery','adminOrders','adminContact','adminSettings'].forEach(id=>{document.getElementById(id).style.display='block'});document.getElementById('adminNotice').style.display='block';}
function hideAdminPanels(){['adminAccueil','adminApropos','adminPrehistoire','adminServices','adminGallery','adminOrders','adminContact','adminSettings'].forEach(id=>{document.getElementById(id).style.display='none'});document.getElementById('adminNotice').style.display='none';}

// ----- Hero admin -----
function saveHero(){
    const t=document.getElementById('editHeroText').value;
    state.hero.text=t;
    const f=document.getElementById('editHeroImage').files[0];
    if(f){
        const r=new FileReader();
        r.onload=function(){state.hero.image=r.result; saveState(); renderAll();}
        r.readAsDataURL(f);
    } else {saveState(); renderAll();}
}
function resetHero(){state.hero=defaultState().hero; saveState(); renderAll();}

// ----- About admin -----
function saveAbout(){state.about=document.getElementById('editAbout').value; saveState(); renderAll();}

// ----- Prehistoire admin -----
function savePrehistoire(){state.prehistoire=document.getElementById('editPrehistoire').value; saveState(); renderAll();}

// ----- Services admin -----
function saveServices(){
    state.services=document.getElementById('editServices').value.split('\n').filter(Boolean);
    saveState(); renderServices(); populateOeuvres();
}

// ----- Gallery admin -----
function addGalleryItem(){
    const f=document.getElementById('galleryFile').files[0];
    if(!f) return alert('Choisir une image');
    const t=document.getElementById('galleryTitle').value||'Titre';
    const d=document.getElementById('galleryDesc').value||'';
    const p=document.getElementById('galleryPrice').value||'';
    const r=new FileReader();
    r.onload=function(){state.gallery.push({image:r.result,title:t,desc:d,price:p}); saveState(); renderGallery(); populateOeuvres();}
    r.readAsDataURL(f);
}
function clearGallery(){ if(confirm('Vider toute la galerie ?')){state.gallery=[]; saveState(); renderGallery(); populateOeuvres();}}

// ----- Contact admin -----
function saveContact(){
    state.contact.email=document.getElementById('editContactEmail').value;
    state.contact.tel=document.getElementById('editContactTel').value;
    state.contact.fb=document.getElementById('editContactFB').value;
    state.contact.wa=document.getElementById('editContactWA').value;
    saveState(); renderAll();
}

// ----- Orders -----
document.getElementById('orderForm').addEventListener('submit',function(e){
    e.preventDefault();
    const o={name:document.getElementById('orderName').value,
             email:document.getElementById('orderEmail').value,
             tel:document.getElementById('orderTel').value,
             type:document.getElementById('orderType').value,
             oeuvre:document.getElementById('orderOeuvre').value,
             qty:document.getElementById('orderQty').value,
             msg:document.getElementById('orderMsg').value};
    state.orders.push(o); saveState(); alert('Commande enregistrée !'); resetOrderForm(); renderOrders();
});
function resetOrderForm(){document.getElementById('orderForm').reset();}
function renderOrders(){
    const l=document.getElementById('ordersList'); if(!l) return; l.innerHTML='';
    state.orders.forEach(o=>{
        const d=document.createElement('div');
        d.style.padding='8px'; d.style.borderBottom='1px solid #eee';
        d.innerHTML=`<strong>${o.name}</strong> (${o.email})<br>${o.type} / ${o.oeuvre} x${o.qty}<br>${o.msg || ''}`;
        l.appendChild(d);
    });
}
function clearOrders(){ if(confirm('Vider toutes les commandes ?')){state.orders=[]; saveState(); renderOrders();}}

// ----- Admin creds -----
function changeAdminCreds(){
    const e=document.getElementById('newAdminEmail').value;
    const p=document.getElementById('newAdminPass').value;
    if(e) state.creds.email=e;
    if(p) state.creds.pass=p;
    saveState(); alert('Identifiants modifiés');
}

// ----- JSON Backup -----
function exportJSON(){
    const d=document.createElement('a');
    d.href='data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(state));
    d.download='backup_sculpture.json';
    d.click();
}
function importJSON(){
    const f=document.getElementById('importFile').files[0];
    if(!f) return;
    const r=new FileReader();
    r.onload=function(){
        try{state=JSON.parse(r.result); saveState(); renderAll(); alert('Importé avec succès');}
        catch(e){alert('Erreur import JSON');}
    }
    r.readAsText(f);
}

// ----- Populate order select -----
function populateOeuvres(){
    const sel=document.getElementById('orderOeuvre'); if(!sel) return;
    sel.innerHTML='';
    state.gallery.forEach(g=>{const o=document.createElement('option'); o.value=g.title; o.textContent=g.title; sel.appendChild(o);});
}

// ----- Init -----
loadState(); renderAll();
</script>
