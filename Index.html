<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>L'Art de la Sculpture Malgache</title>
<style>
:root{--accent:#8B5E3C;--bg:#fbf8f5;--muted:#666;--card:#fff}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#222}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:var(--accent);color:#fff}
.brand{font-weight:800}
.nav{display:flex;gap:8px;flex-wrap:wrap}
.nav button{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;padding:8px 12px;border-radius:999px;cursor:pointer}
.container{max-width:1100px;margin:18px auto;padding:0 16px}
.section{margin-top:18px;padding:14px;background:var(--card);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.section h2{color:var(--accent);margin:0 0 10px}
.hero{display:flex;gap:20px;align-items:center}
.hero .left{flex:1}
.thumb{width:320px;border-radius:10px;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover;cursor:pointer}
.services-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px}
.service-card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
.gallery .item{position:relative;border-radius:8px;overflow:hidden;background:#eee;padding-bottom:6px}
.gallery img{width:100%;height:140px;object-fit:cover;display:block;cursor:pointer;transition:transform .18s}
.gallery img:hover{transform:scale(1.04)}
.caption{padding:8px;font-size:13px}
.title{font-weight:700;color:#222}
.desc{color:var(--muted);font-size:13px;margin-top:4px}
.price{color:var(--accent);font-weight:800;margin-top:6px}
.footer{padding:20px;text-align:center;color:var(--muted)}
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px}
.lightbox .box{background:#fff;padding:12px;border-radius:10px;max-width:900px;width:100%;display:flex;gap:12px;align-items:flex-start}
.lightbox img{max-width:60%;height:auto;border-radius:8px}
.lightbox .info{max-width:40%}
.input,textarea,input[type=file],select{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd;margin-bottom:8px}
.btn{background:var(--accent);color:#fff;border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn.ghost{background:transparent;color:var(--accent);border:1px solid var(--accent)}
.admin-toolbar{margin-top:12px;padding:10px;background:#fff8f0;border-radius:8px;border:1px dashed #efd0b3;display:none}
.admin-panel{margin-top:10px;background:#fff8f0;padding:12px;border-radius:10px;display:none}
.login-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:10000}
.login-card{background:#fff;padding:18px;border-radius:12px;width:94%;max-width:420px}
.row{display:flex;gap:8px}
.row .col{flex:1}
.note{color:var(--muted);font-size:13px}
@media(max-width:820px){.hero{flex-direction:column}.thumb{width:100%}.lightbox .box{flex-direction:column}.lightbox img{max-width:100%}.lightbox .info{max-width:100%}}
</style>
</head>
<body>

<header class="header">
  <div class="brand">L'Art de la Sculpture Malgache</div>
  <nav class="nav">
    <button onclick="show('accueil')">Accueil</button>
    <button onclick="show('apropos')">À propos</button>
    <button onclick="show('prehistoire')">Pré-histoire</button>
    <button onclick="show('services')">Services</button>
    <button onclick="show('galerie')">Galerie</button>
    <button onclick="show('commande')">Commander</button>
    <button onclick="show('contact')">Contact</button>
    <button onclick="openLogin()">Admin</button>
  </nav>
</header>

<main class="container">
  <!-- Accueil -->
  <section id="accueil" class="section">
    <div class="hero">
      <div class="left">
        <h2 id="heroTitle">Histoire & héritage de la sculpture malgache</h2>
        <p id="heroText">Le sculpteur malgache puise son inspiration dans les traditions ancestrales et les légendes locales. Depuis des siècles, l’art de la sculpture transmet la culture, les croyances et l’âme du peuple.</p>
        <div class="note" id="adminNotice" style="display:none">Admin connecté — outils d'édition visibles</div>
      </div>
      <div class="thumb">
        <img id="heroImg" src="images/madagascar1.jpg" alt="Accueil" onclick="openLightboxFromHero()">
      </div>
    </div>

    <div id="adminAccueil" class="admin-panel">
      <h3>Modifier Accueil</h3>
      <textarea id="editHeroText" rows="4" class="input"></textarea>
      <input type="file" id="editHeroImage" accept="image/*" class="input">
      <div class="row">
        <button class="btn" onclick="saveHero()">Enregistrer</button>
        <button class="btn ghost" onclick="resetHero()">Réinitialiser</button>
      </div>
      <p class="note">Uploader depuis téléphone/ordinateur. Les images sont stockées localement dans le navigateur (localStorage).</p>
    </div>
  </section>

  <!-- À propos -->
  <section id="apropos" class="section" style="display:none">
    <h2>À propos</h2>
    <p id="aboutText">Artisan sculpteur malgache — bois, pierre et matériaux naturels.</p>
    <div id="adminApropos" class="admin-panel">
      <h3>Modifier À propos</h3>
      <textarea id="editAbout" rows="4" class="input"></textarea>
      <button class="btn" onclick="saveAbout()">Enregistrer</button>
    </div>
  </section>

  <!-- Pré-histoire -->
  <section id="prehistoire" class="section" style="display:none">
    <h2>Pré-histoire et Origines</h2>
    <p id="prehistoireText">Les premières sculptures malgaches remontent à des siècles ; elles représentaient ancêtres et esprits. Chaque région a développé un style propre.</p>
    <div id="adminPrehistoire" class="admin-panel">
      <h3>Modifier Pré-histoire</h3>
      <textarea id="editPrehistoire" rows="4" class="input"></textarea>
      <button class="btn" onclick="savePrehistoire()">Enregistrer</button>
    </div>
  </section>

  <!-- Services -->
  <section id="services" class="section" style="display:none">
    <h2>Services</h2>
    <div id="servicesGrid" class="services-grid"></div>
    <div id="adminServices" class="admin-panel">
      <h3>Modifier Services</h3>
      <textarea id="editServices" rows="4" class="input" placeholder="Une ligne = un service"></textarea>
      <button class="btn" onclick="saveServices()">Enregistrer</button>
    </div>
  </section>

  <!-- Galerie -->
  <section id="galerie" class="section" style="display:none">
    <h2>Galerie</h2>
    <div id="galleryGrid" class="gallery"></div>

    <div id="adminGallery" class="admin-panel">
      <h3>Gérer la galerie (titre / description / prix)</h3>
      <input type="file" id="galleryFile" accept="image/*" class="input">
      <input id="galleryTitle" class="input" placeholder="Titre (ex: Sculpture Bois 1)">
      <input id="galleryPrice" class="input" placeholder="Prix (ex: 120 000 MGA)">
      <textarea id="galleryDesc" rows="2" class="input" placeholder="Brève description"></textarea>
      <div class="row">
        <button class="btn" onclick="addGalleryItem()">Ajouter</button>
        <button class="btn ghost" onclick="clearGallery()">Vider la galerie</button>
      </div>
      <div id="galleryAdminList" style="margin-top:12px"></div>
      <p class="note">Remplacer une image : utilisez le bouton "Remplacer" à côté de la miniature. Supprimer : bouton "Supprimer".</p>
    </div>
  </section>

  <!-- Commande -->
  <section id="commande" class="section" style="display:none">
    <h2>Commander une œuvre</h2>
    <form id="orderForm">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input type="text" id="orderName" placeholder="Votre nom" required>
        <input type="email" id="orderEmail" placeholder="Votre e-mail" required>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input type="text" id="orderTel" placeholder="Téléphone">
        <select id="orderType"><option value="bois">Bois</option><option value="pierre">Pierre</option><option value="mixte">Mixte</option></select>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
        <select id="orderOeuvre"></select>
        <input type="number" id="orderQty" min="1" value="1">
      </div>
      <textarea id="orderMsg" placeholder="Message / détails" style="margin-top:8px"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" type="submit">Envoyer la commande</button>
        <button class="btn ghost" type="button" onclick="resetOrderForm()">Annuler</button>
      </div>
    </form>

    <div id="adminOrders" class="admin-panel">
      <h3>Commandes reçues</h3>
      <div id="ordersList"></div>
      <div style="margin-top:8px"><button class="btn ghost" onclick="clearOrders()">Vider les commandes</button></div>
    </div>
  </section>

  <!-- Contact -->
  <section id="contact" class="section" style="display:none">
    <h2>Contact</h2>
    <p>Email : <span id="contactEmail">contact@artmalagasy.mg</span></p>
    <p>Téléphone : <span id="contactTel">+261 34 00 000 00</span></p>
    <p>Facebook : <span id="contactFB">facebook.com/natureartisanale</span></p>
    <p>WhatsApp : <span id="contactWA">+261 34 00 000 00</span></p>

    <div id="adminContact" class="admin-panel">
      <h3>Modifier Contact</h3>
      <input id="editContactEmail" class="input" placeholder="Email">
      <input id="editContactTel" class="input" placeholder="Téléphone">
      <input id="editContactFB" class="input" placeholder="Facebook">
      <input id="editContactWA" class="input" placeholder="WhatsApp">
      <button class="btn" onclick="saveContact()">Enregistrer</button>
    </div>
  </section>

  <!-- Admin Settings -->
  <section id="adminSettings" class="section" style="display:none">
    <h2>Administration</h2>
    <div class="admin-panel">
      <h3>Modifier identifiants Admin</h3>
      <div class="row">
        <div class="col"><input id="newAdminEmail" class="input" placeholder="Nouvel email"></div>
        <div class="col"><input id="newAdminPass" class="input" placeholder="Nouveau mot de passe"></div>
      </div>
      <div class="row">
        <button class="btn" onclick="changeAdminCreds()">Enregistrer identifiants</button>
        <button class="btn ghost" onclick="logoutAdmin()">Se déconnecter</button>
      </div>
    </div>

    <div class="admin-panel">
      <h3>Sauvegarder / Restaurer</h3>
      <div class="row">
        <button class="btn" onclick="exportJSON()">Exporter JSON</button>
        <input type="file" id="importFile" class="input">
        <button class="btn ghost" onclick="importJSON()">Importer JSON</button>
      </div>
      <p class="note">Le backup contient tout le contenu (images en base64 si uploadées).</p>
    </div>
  </section>
</main>

<footer class="footer">© <span id="year"></span> L'Art de la Sculpture Malgache — Madagascar</footer>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox" onclick="if(event.target.id==='lightbox') closeLightbox()">
  <div class="box">
    <img id="lightboxImg" src="">
    <div class="info">
      <div class="title" id="lightboxTitle"></div>
      <div class="desc" id="lightboxDesc"></div>
      <div class="price" id="lightboxPrice"></div>
      <div style="margin-top:10px"><button class="btn" onclick="closeLightbox()">Fermer</button></div>
    </div>
  </div>
</div>

<!-- LOGIN MODAL -->
<div id="loginModal" class="login-modal" onclick="if(event.target.id==='loginModal') closeLogin()">
  <div class="login-card">
    <h3>Connexion Admin</h3>
    <input id="loginEmail" class="input" placeholder="Email">
    <input id="loginPass" class="input" placeholder="Mot de passe" type="password">
    <div class="row">
      <button class="btn" onclick="login()">Se connecter</button>
      <button class="btn ghost" onclick="closeLogin()">Annuler</button>
    </div>
    <p id="loginError" style="color:#b00020"></p>
    <p class="note">Identifiants par défaut : <strong>admin@site.com</strong> / <strong>1234</strong></p>
  </div>
</div>

<script>
/* -----------------------------
   State saved in localStorage
   ----------------------------- */
const KEY = 'sculpture_gallery_final_v1';
function defaultState(){
  return {
    creds:{email:'admin@site.com',pass:'1234'},
    hero:{text:`Le sculpteur malgache puise son inspiration dans les traditions ancestrales et les légendes locales. Depuis des siècles, l’art de la sculpture transmet la culture, les croyances et l’âme du peuple.`, image:'images/madagascar1.jpg'},
    about:'Artisan sculpteur malgache — bois, pierre et matériaux naturels.',
    prehistoire:'Les premières sculptures malgaches remontent à des siècles ; elles représentaient ancêtres et esprits.',
    services:['Commandes personnalisées','Restauration d’œuvres','Expositions','Ateliers & Formations'],
    contact:{email:'contact@artmalagasy.mg',tel:'+261 34 00 000 00',fb:'facebook.com/natureartisanale',wa:'+261 34 00 000 00'},
    gallery:[
      {image:'images/madagascar1.jpg', title:'Sculpture Bois 1', desc:'Bois sculpté, finitions naturelles', price:'120 000 MGA'},
      {image:'images/madagascar2.jpg', title:'Sculpture Pierre 1', desc:'Pierre gravée, ton vert', price:'200 000 MGA'},
      {image:'images/madagascar3.jpg', title:'Sculpture Mixte 1', desc:'Bois & pierre, design contemporain', price:'150 000 MGA'},
      {image:'images/madagascar4.jpg', title:'Sculpture Bois 2', desc:'Bois poli, motifs traditionnels', price:'130 000 MGA'},
      {image:'images/madagascar5.jpg', title:'Sculpture Pierre 2', desc:'Pierre taillée, finition fine', price:'210 000 MGA'}
    ],
    orders:[]
  };
}

let state;
function loadState(){
  try{ const r = localStorage.getItem(KEY); state = r ? JSON.parse(r) : defaultState(); }catch(e){ state = defaultState(); }
  saveState();
}
function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }

/* -----------------------------
   Rendering
   ----------------------------- */
function renderAll(){
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('heroText').textContent = state.hero.text;
  document.getElementById('heroImg').src = state.hero.image;
  document.getElementById('aboutText').textContent = state.about;
  document.getElementById('prehistoireText').textContent = state.prehistoire;
  document.getElementById('servicesGrid').innerHTML = state.services.map(s=>`<div class="service-card">${escapeHtml(s)}</div>`).join('');
  document.getElementById('contactEmail').textContent = state.contact.email;
  document.getElementById('contactTel').textContent = state.contact.tel;
  document.getElementById('contactFB').textContent = state.contact.fb;
  document.getElementById('contactWA').textContent = state.contact.wa;
  renderGallery();
  populateOrderOeuvre();
  renderOrders();
}
function renderGallery(){
  const g = document.getElementById('galleryGrid');
  if(!state.gallery || state.gallery.length===0){ g.innerHTML = '<p class="note">Aucune œuvre pour le moment.</p>'; return; }
  g.innerHTML = state.gallery.map((it,idx)=>`
    <div class="item" data-idx="${idx}">
      <img src="${escapeHtml(it.image)}" alt="${escapeHtml(it.title)}" onclick="openLightboxFromGallery(${idx})">
      <div class="caption">
        <div class="title">${escapeHtml(it.title)}</div>
        <div class="desc">${escapeHtml(it.desc)}</div>
        <div class="price">${escapeHtml(it.price)}</div>
      </div>
    </div>`).join('');
}

/* -----------------------------
   Helpers / UI
   ----------------------------- */
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>\"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":"&#39;"}[m])); }
function show(id){ document.querySelectorAll('.section').forEach(s=>s.style.display='none'); const el = document.getElementById(id); if(el) el.style.display='block'; toggleAdminUI(); if(id==='galerie') renderGalleryAdminList(); }
function openLightboxFromHero(){ openLightbox(state.hero.image, "Image d'accueil", '', ''); }
function openLightboxFromGallery(idx){ const it = state.gallery[idx]; openLightbox(it.image, it.title, it.desc, it.price); }
function openLightbox(src, title, desc, price){ if(!src) return; document.getElementById('lightboxImg').src = src; document.getElementById('lightboxTitle').innerText = title || ''; document.getElementById('lightboxDesc').innerText = desc || ''; document.getElementById('lightboxPrice').innerText = price || ''; document.getElementById('lightbox').style.display='flex'; }
function closeLightbox(){ document.getElementById('lightbox').style.display='none' }

/* -----------------------------
   Admin login & toggles
   ----------------------------- */
let logged=false;
function openLogin(){ document.getElementById('loginModal').style.display='flex'; document.getElementById('loginError').innerText=''; }
function closeLogin(){ document.getElementById('loginModal').style.display='none'; }
function login(){ const e = document.getElementById('loginEmail').value.trim(); const p = document.getElementById('loginPass').value.trim(); if(e === state.creds.email && p === state.creds.pass){ logged=true; closeLogin(); toggleAdminUI(); prefillAdmin(); alert('Connecté en tant qu\'Admin'); } else { document.getElementById('loginError').innerText = 'Email ou mot de passe incorrect'; } }
function logoutAdmin(){ logged=false; toggleAdminUI(); show('accueil'); alert('Déconnecté'); }
function toggleAdminUI(){ const panels = document.querySelectorAll('.admin-panel'); panels.forEach(p=>p.style.display = logged ? 'block' : 'none'); document.getElementById('adminNotice').style.display = logged ? 'block' : 'none'; document.getElementById('adminSettings').style.display = logged ? 'block' : 'none'; }

/* -----------------------------
   Prefill admin fields
   ----------------------------- */
function prefillAdmin(){ document.getElementById('editHeroText').value = state.hero.text; document.getElementById('editAbout').value = state.about; document.getElementById('editPrehistoire').value = state.prehistoire; document.getElementById('editServices').value = (state.services||[]).join('
'); document.getElementById('editContactEmail').value = state.contact.email; document.getElementById('editContactTel').value = state.contact.tel; document.getElementById('editContactFB').value = state.contact.fb; document.getElementById('editContactWA').value = state.contact.wa; document.getElementById('newAdminEmail').value = state.creds.email; document.getElementById('newAdminPass').value = ''; renderGalleryAdminList(); }

/* -----------------------------
   Admin actions: Hero
   ----------------------------- */
function saveHero(){ const t = document.getElementById('editHeroText').value.trim(); const file = document.getElementById('editHeroImage').files[0]; if(t) state.hero.text = t; if(file){ const r = new FileReader(); r.onload = e => { state.hero.image = e.target.result; saveState(); renderAll(); prefillAdmin(); alert('Accueil mis à jour'); }; r.readAsDataURL(file); } else { saveState(); renderAll(); prefillAdmin(); alert('Accueil mis à jour'); } }
function resetHero(){ if(!confirm('Réinitialiser tout le site aux valeurs par défaut ?')) return; state = defaultState(); saveState(); renderAll(); prefillAdmin(); alert('Réinitialisé'); }

/* -----------------------------
   About / Prehistoire / Services / Contact
   ----------------------------- */
function saveAbout(){ const v=document.getElementById('editAbout').value.trim(); if(v) state.about=v; saveState(); renderAll(); alert('À propos enregistré'); }
function savePrehistoire(){ const v=document.getElementById('editPrehistoire').value.trim(); if(v) state.prehistoire=v; saveState(); renderAll(); alert('Pré-histoire enregistré'); }
function saveServices(){ const arr=document.getElementById('editServices').value.split('
').map(s=>s.trim()).filter(Boolean); if(arr.length) state.services=arr; saveState(); renderAll(); alert('Services enregistrés'); }
function saveContact(){ const e=document.getElementById('editContactEmail').value.trim(); const t=document.getElementById('editContactTel').value.trim(); const f=document.getElementById('editContactFB').value.trim(); const w=document.getElementById('editContactWA').value.trim(); if(e) state.contact.email=e; if(t) state.contact.tel=t; if(f) state.contact.fb=f; if(w) state.contact.wa=w; saveState(); renderAll(); alert('Contact enregistré'); }

/* -----------------------------
   Admin: Gallery add/replace/delete/edit
   ----------------------------- */
function addGalleryItem(){ const f = document.getElementById('galleryFile').files[0]; const t = document.getElementById('galleryTitle').value.trim() || 'Titre'; const d = document.getElementById('galleryDesc').value.trim() || ''; const p = document.getElementById('galleryPrice').value.trim() || ''; if(!f){ alert('Choisis un fichier image'); return; } const r = new FileReader(); r.onload = e => { state.gallery.unshift({ image:e.target.result, title:t, desc:d, price:p }); saveState(); renderAll(); renderGalleryAdminList(); document.getElementById('galleryFile').value=''; document.getElementById('galleryTitle').value=''; document.getElementById('galleryDesc').value=''; document.getElementById('galleryPrice').value=''; alert('Image ajoutée'); }; r.readAsDataURL(f); }

function renderGalleryAdminList(){ const c = document.getElementById('galleryAdminList'); c.innerHTML = ''; (state.gallery||[]).forEach((it, idx)=>{ const row = document.createElement('div'); row.style.display='flex'; row.style.alignItems='center'; row.style.gap='8px'; row.style.marginBottom='8px'; const img = document.createElement('img'); img.src = it.image; img.style.width='100px'; img.style.height='70px'; img.style.objectFit='cover'; img.style.borderRadius='6px'; const info = document.createElement('div'); info.style.flex='1'; info.innerHTML = `<div style="font-weight:700">${escapeHtml(it.title)}</div><div class="note">${escapeHtml(it.price)}</div><div class="note">${escapeHtml(it.desc)}</div>`; const replace = document.createElement('input'); replace.type='file'; replace.accept='image/*'; replace.onchange = e => replaceGalleryImage(e, idx); const editBtn = document.createElement('button'); editBtn.className='btn small'; editBtn.innerText='Modifier (titre/desc/prix)'; editBtn.onclick = ()=> editGalleryItem(idx); const del = document.createElement('button'); del.className='btn ghost small'; del.innerText='Supprimer'; del.onclick = ()=> { if(confirm('Supprimer cette image ?')){ state.gallery.splice(idx,1); saveState(); renderAll(); renderGalleryAdminList(); } }; row.appendChild(img); row.appendChild(info); row.appendChild(replace); row.appendChild(editBtn); row.appendChild(del); c.appendChild(row); }); }

function replaceGalleryImage(e, idx){ const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = ev => { state.gallery[idx].image = ev.target.result; saveState(); renderAll(); renderGalleryAdminList(); alert('Image remplacée'); }; r.readAsDataURL(f); }

function editGalleryItem(idx){ const it = state.gallery[idx]; const t = prompt('Titre', it.title || ''); if(t===null) return; const d = prompt('Description', it.desc || ''); if(d===null) return; const p = prompt('Prix', it.price || ''); if(p===null) return; it.title = t; it.desc = d; it.price = p; saveState(); renderAll(); renderGalleryAdminList(); alert('Modifications enregistrées'); }

function clearGallery(){ if(!confirm('Vider la galerie ?')) return; state.gallery = []; saveState(); renderAll(); renderGalleryAdminList(); alert('Galerie vidée'); }

/* -----------------------------
   Orders (commandes)
   ----------------------------- */
function populateOrderOeuvre(){ const sel = document.getElementById('orderOeuvre'); sel.innerHTML=''; (state.gallery||[]).forEach((it,idx)=>{ const opt = document.createElement('option'); opt.value = idx; opt.text = `${it.title} — ${it.price || ''}`; sel.appendChild(opt); }); }

document.addEventListener('submit', function(e){ if(e.target && e.target.id==='orderForm'){ e.preventDefault(); const nom = document.getElementById('orderName').value.trim(); const email = document.getElementById('orderEmail').value.trim(); const tel = document.getElementById('orderTel').value.trim(); const type = document.getElementById('orderType').value; const oeuvreIndex = +document.getElementById('orderOeuvre').value; const qty = +document.getElementById('orderQty').value; const msg = document.getElementById('orderMsg').value.trim(); const oeuvre = state.gallery[oeuvreIndex] || {}; const order = { nom,email,tel,type,oeuvreIndex,qty,msg,titre:oeuvre.title||'',prix_unitaire:oeuvre.price||'' , date: new Date().toISOString() }; state.orders.unshift(order); saveState(); renderOrders(); alert('Commande reçue ! Merci.'); e.target.reset(); } });

function renderOrders(){ const d = document.getElementById('ordersList'); d.innerHTML=''; if(!state.orders||state.orders.length===0){ d.innerText='Pas de commandes pour le moment.'; return; } state.orders.forEach((o,i)=>{ const div = document.createElement('div'); div.style.borderBottom='1px solid #eee'; div.style.padding='8px 0'; div.innerHTML = `<strong>${escapeHtml(o.nom)}</strong> (${escapeHtml(o.email)}) — ${new Date(o.date).toLocaleString()}<br>Œuvre: ${escapeHtml(o.titre)} | Type: ${escapeHtml(o.type)} | Qté: ${o.qty}<br>Message: ${escapeHtml(o.msg)}<br>Prix unitaire: ${escapeHtml(o.prix_unitaire)}`; const btnDel = document.createElement('button'); btnDel.className='btn ghost small'; btnDel.style.marginLeft='8px'; btnDel.innerText='Supprimer'; btnDel.onclick = ()=>{ if(confirm('Supprimer cette commande ?')){ state.orders.splice(i,1); saveState(); renderOrders(); } }; div.appendChild(btnDel); d.appendChild(div); }); }

function clearOrders(){ if(!confirm('Vider toutes les commandes ?')) return; state.orders = []; saveState(); renderOrders(); alert('Commandes vidées'); }

function resetOrderForm(){ document.getElementById('orderForm').reset(); }

/* -----------------------------
   Admin: change creds, export/import
   ----------------------------- */
function changeAdminCreds(){ const ne = document.getElementById('newAdminEmail').value.trim(); const np = document.getElementById('newAdminPass').value.trim(); if(ne) state.creds.email = ne; if(np) state.creds.pass = np; saveState(); alert('Identifiants mis à jour'); }

function exportJSON(){ const blob = new Blob([JSON.stringify(state,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='site_backup.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),3000); }
function importJSON(){ const f = document.getElementById('importFile').files[0]; if(!f){ alert('Choisir un fichier JSON'); return; } const r = new FileReader(); r.onload = e => { try{ const obj = JSON.parse(e.target.result); if(obj && obj.gallery && obj.hero){ state = Object.assign(defaultState(), obj); saveState(); renderAll(); prefillAdmin(); alert('Import OK'); } else throw new Error('Format invalide'); }catch(err){ alert('Fichier invalide'); } }; r.readAsText(f); }

/* -----------------------------
   Init
   ----------------------------- */
document.addEventListener('DOMContentLoaded', ()=>{ loadState(); renderAll(); show('accueil'); // default view
});
</script>
</body>
</html>
