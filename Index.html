<section style="margin-top:18px">
  <h2>Galerie d'œuvres</h2>
  <div id="galleryGrid" class="gallery"></div>
</section>

<section style="margin-top:18px">
  <h2>Biographie de l'artiste</h2>
  <p id="bioText">Texte de biographie modifiable depuis l'admin.</p>
</section>

<script>
const STORAGE_KEY = 'sculpture_mg_data_v2';
let DATA = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
  infoText: "Bienvenue sur la galerie. Texte d'accueil modifiable dans l'interface admin.",
  bioText: "Sculpture MG est un artiste malgache passionné par la sculpture sur bois et pierre.",
  artworks: [
    {id:1, title:"Sculpture Ancestrale", desc:"Bois sculpté, 45cm", price:"120 000 MGA", image:"https://images.unsplash.com/photo-1526318472351-c75fcf0700c4?auto=format&fit=crop&w=800&q=60"},
    {id:2, title:"Tête de Roi", desc:"Pierre gravée", price:"200 000 MGA", image:"https://images.unsplash.com/photo-1526481280698-9f2f7c5d7b23?auto=format&fit=crop&w=800&q=60"}
  ]
};

function saveData(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA)); renderAll(); }

function renderAll(){
  // Galerie
  const gallery = document.getElementById('galleryGrid');
  gallery.innerHTML = '';
  DATA.artworks.forEach(a => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${a.image}" alt="${a.title}">
      <div class="card-body">
        <div class="title">${a.title}</div>
        <div class="desc">${a.desc}</div>
        <div class="price">${a.price}</div>
      </div>
    `;
    gallery.appendChild(card);
  });

  // Texte général et biographie
  document.getElementById('infoText').innerText = DATA.infoText;
  document.getElementById('bioText').innerText = DATA.bioText;
}

// --- ADMIN PANEL ---
function openAdmin() {
  const pw = prompt("Mot de passe admin :");
  if(pw !== (localStorage.getItem('adminPassword') || 'admin123')){
    alert("Mot de passe incorrect");
    return;
  }
  const panel = document.createElement('div');
  panel.className='admin-area';
  panel.innerHTML = `
    <h3>Admin Panel</h3>
    <label>Texte d'accueil :</label><textarea id="adminInfoText">${DATA.infoText}</textarea>
    <label>Biographie :</label><textarea id="adminBioText">${DATA.bioText}</textarea>
    <h4>Ajouter une œuvre</h4>
    <input id="a_title" placeholder="Titre"><br>
    <input id="a_desc" placeholder="Description"><br>
    <input id="a_price" placeholder="Prix"><br>
    <input id="a_image" placeholder="URL image"><br>
    <button id="addArtworkBtn">Ajouter</button>
    <h4>Œuvres existantes</h4>
    <div id="adminList"></div>
    <button onclick="panel.remove()">Fermer Admin</button>
  `;
  document.body.appendChild(panel);
  refreshAdminList();

  document.getElementById('adminInfoText').addEventListener('blur', e => { DATA.infoText=e.target.value; saveData(); });
  document.getElementById('adminBioText').addEventListener('blur', e => { DATA.bioText=e.target.value; saveData(); });
  document.getElementById('addArtworkBtn').onclick = () => {
    const t = document.getElementById('a_title').value;
    const d = document.getElementById('a_desc').value;
    const p = document.getElementById('a_price').value;
    const i = document.getElementById('a_image').value;
    if(!t || !i){ alert("Titre et image requis"); return; }
    DATA.artworks.push({id:Date.now(), title:t, desc:d, price:p, image:i});
    saveData();
    document.getElementById('a_title').value=''; document.getElementById('a_desc').value=''; document.getElementById('a_price').value=''; document.getElementById('a_image').value='';
    refreshAdminList();
  };
}

function refreshAdminList(){
  const list = document.getElementById('adminList');
  list.innerHTML='';
  DATA.artworks.forEach((a, i) => {
    const div = document.createElement('div');
    div.innerHTML = <b>${a.title}</b> <button onclick="deleteArtwork(${i})">Supprimer</button>;
    list.appendChild(div);
  });
}

function deleteArtwork(i){
  if(confirm("Supprimer cette œuvre ?")){
    DATA.artworks.splice(i,1);
    saveData();
    refreshAdminList();
  }
}

window.onload = renderAll;
</script>

<button onclick="openAdmin()" class="btn btn-outline" style="position:fixed;bottom:20px;right:20px;">Admin</button>
